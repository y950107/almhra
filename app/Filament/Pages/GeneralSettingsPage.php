<?php

namespace App\Filament\Resources\SettingsResource\Pages;


use Tabs\Tab;
use Filament\Forms;
use Filament\Forms\Form;
use Filament\Pages\SettingsPage;
use App\Settings\GeneralSettings;
use App\Services\PrayerTimeService;
use Filament\Forms\Components\Tabs;
use Illuminate\Support\Facades\Auth;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Toggle;
use Filament\Forms\Components\Section;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\FileUpload;
use BezhanSalleh\FilamentShield\Traits\HasPageShield;




class GeneralSettingsPage extends SettingsPage
{
    use HasPageShield;

    protected static ?string $navigationIcon = 'heroicon-o-cog';
    protected static ?string $navigationLabel = 'ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ';
    protected static ?string $navigationGroup = 'ุงูุฅุนุฏุงุฏุงุช';
    protected static string $settings = GeneralSettings::class;
    /*   public static function canAccess(): bool
    {
        $user = Auth::user();

        return $user && method_exists($user, 'can') && $user->can('view_general_settings');
    } */
    public static function getPermissionPrefixes(): array
    {
        return ['view', 'view_any', 'create', 'update', 'delete', 'delete_any'];
    }

    public function form(Form $form): Form
    {
        return $form->schema([
            Section::make()
                ->columns(2)
                ->schema([
                    Tabs::make('ุฅุนุฏุงุฏุงุช ุงููุธุงู')
                        ->extraAttributes(['data-tabs-id' => 'settings-tabs'])
                        ->tabs([


                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุงูุทูุงุจ')->schema([
                                Section::make('ุงููุฆุฉ ุงูุนูุฑูุฉ')->schema([
                                    TextInput::make('min_age')->label('ุงูุนูุฑ ุงูุฃุฏูู')->required()->numeric(),
                                    TextInput::make('max_age')->label('ุงูุนูุฑ ุงูุฃูุตู')->required()->numeric(),

                                ]),
                                Section::make('ูุนุฏู ุงููุจูู')->schema([
                                    TextInput::make('passing_percentage')->label('ุงููุนุฏู %')->required()->numeric(),
                                ]),
                                Section::make('ุงูุนุฏุฏ ุงูุงูุตู ููุทูุงุจ ุงูููุชุญููู ุจุงูุญููุฉ')->schema([
                                    TextInput::make('students_per_group')->label('ุนุฏุฏ ุงูุทูุงุจ ูู ุงูุญููุฉ')->required()->numeric(),
                                ]),

                                Section::make('ุงููุจูู ุงูุชููุงุฆู')->schema([
                                    Toggle::make('auto_accept_students')->label('ูุจูู ุ'),
                                ])
                            ]),

                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุญููุงุช ุงูุชุณููุน ')->schema([
                                Section::make()->schema([
                                    Repeater::make('reading_types')
                                        ->label(' ุงููุฑุงุกุงุช')
                                        ->schema([
                                            TextInput::make('reading')->label('ุงุณู ุงููุฑุงุกุฉ')->placeholder('ูุซุงู: ุญูุต ุนู ุนุงุตู')->required(),
                                        ])
                                        ->minItems(1)
                                        ->addable()
                                        ->reorderable()
                                        ->deletable(),
                                ]),

                                Section::make('ุงูุงูุฒุงู ู ูุนุงููุฑ ุงูุชูููู')->schema([
                                    TextInput::make('tajweed_weight')->label('ูุฒู ุงูุชุฌููุฏ')->required()->numeric(),
                                    TextInput::make('memorization_weight')->label('ูุฒู ุงูุญูุธ')->required()->numeric(),
                                    TextInput::make('voice_quality_weight')->label('ูุฒู ุฌูุฏุฉ ุงูุตูุช')->required()->numeric(),
                                ]),

                                Section::make('ุฎุทุฉ ุงูุชุณููุน')->schema([
                                    TextInput::make('session_duration')->label('ูุฏุฉ ุงูุฌูุณุฉ ุจุงูุฏูุงุฆู')->required()->numeric(),
                                    TextInput::make('max_pages_per_session')->label('ุฃูุตู ุนุฏุฏ ููุตูุญุงุช ูู ุงูุฌูุณุฉ')->required()->numeric(),
                                ]),

                                Section::make('ุชุญูู ูู ุงูุชูุงุฑูุฑ')->schema([
                                    Toggle::make('enable_weekly_reports')->label('ุชูุนูู ุงูุชูุงุฑูุฑ ุงูุฃุณุจูุนูุฉ'),
                                    Toggle::make('enable_monthly_reports')->label('ุชูุนูู ุงูุชูุงุฑูุฑ ุงูุดูุฑูุฉ'),
                                    Toggle::make('enable_yearly_reports')->label('ุชูุนูู ุงูุชูุงุฑูุฑ ุงูุณูููุฉ'),
                                ])
                            ]),

                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุงูุฃูุณูุฉ')->schema([
                                Section::make()->schema([
                                    Toggle::make('badges_enabled')->label('ุชูุนูู ุงูุฃูุณูุฉ'),
                                    Repeater::make('badges_levels')
                                        ->label('ูุณุชููุงุช ุงูุฃูุณูุฉ')
                                        ->schema([
                                            TextInput::make('level')->label('ุงุณู ุงููุณุชูู')->required(),
                                            TextInput::make('required_points')->label('ุงูููุงุท ุงููุทููุจุฉ')->required()->numeric(),
                                        ]),
                                    Repeater::make('badge_criteria')
                                        ->label('ูุนุงููุฑ ุงูุญุตูู ุนูู ุงูุฃูุณูุฉ')
                                        ->schema([
                                            TextInput::make('criteria')->label('ุงููุนูุงุฑ')->required(),
                                            TextInput::make('points')->label('ุงูููุงุท')->required()->numeric(),
                                        ]),
                                ]),
                            ]),

                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุนุงูุฉ ')->schema([
                                Section::make('ุงุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุงููุชุฑููู')->schema([
                                    Toggle::make('send_notifications')->label('ุชูุนูู ุงูุฅุดุนุงุฑุงุช')->required(),
                                    TextInput::make('admin_email')->label('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุดุฑู')->required()->email(),
                                ]),
                                Section::make('ุงููุบุฉ')->schema([
                                    Select::make('default_language')->label('ุงููุบุฉ ุงูุงูุชุฑุงุถูุฉ')
                                        ->options([
                                            'ar' => 'ุงูุนุฑุจูุฉ',
                                            'en' => 'ุงูุฅูุฌููุฒูุฉ',
                                        ])
                                        ->required(),

                                    Toggle::make('dark_mode')->label('ุชูุนูู ุงููุถุน ุงููููู'),
                                ])
                            ]),
                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุงูููุดุฃุฉ')->schema([
                                Section::make('ุงูุดุนุงุฑ ูุงูุฃููููุฉ')->schema([
                                    FileUpload::make('logo')->label('ุดุนุงุฑ ุงูููุดุฃุฉ')->image(),
                                    FileUpload::make('favicon')->label('ุงูุฃููููุฉ ุงูููุถูุฉ')->image(),
                                ]),
                                Section::make('ูุนูููุงุช ุงูููุดุฃุฉ')->schema([
                                    TextInput::make('company_name')->label('ุงุณู ุงูููุดุฃุฉ')->required(),
                                    TextInput::make('branch_name')->label('ุงุณู ุงููุฑุน')->required(),
                                    TextInput::make('company_manager')->label('ูุฏูุฑ ุงูููุดุฃุฉ')->required(),
                                    TextInput::make('branch_manager')->label('ูุฏูุฑ ุงููุฑุน')->required(),
                                ]),
                                Section::make('ูุนูููุงุช ุงูุงุชุตุงู')->schema([
                                    TextInput::make('phone_number')->label('ุฑูู ุงููุงุชู')->required()->tel(),
                                    TextInput::make('contact_email')->label('ุงูุจุฑูุฏ ุงูุฅููุชุฑููู')->required()->email(),
                                ]),

                            ]),

                            // ๐น ุฅุนุฏุงุฏุงุช ุงูููุช ูุฃูุงู ุงูุฃุณุจูุน
                            Tabs\Tab::make('ุฅุนุฏุงุฏุงุช ุงูููุช')->schema([
                                Section::make('ุงูุชูููู')->schema([
                                    Select::make('calendar_type')->label('ููุน ุงูุชูููู')
                                        ->options([
                                            'gregorian' => 'ูููุงุฏู',
                                            'hijri' => 'ูุฌุฑู',
                                        ])
                                        ->required(),
                                ]),
                                Section::make('ุฃูุงู ุงูุนูู')->schema([
                                    Repeater::make('working_days')
                                        ->label('ุฃูุงู ุงูุฃุณุจูุน')
                                        ->schema([
                                            Select::make('day')->label('ุงูููู')
                                                ->options([
                                                    'saturday' => 'ุงูุณุจุช',
                                                    'sunday' => 'ุงูุฃุญุฏ',
                                                    'monday' => 'ุงูุฅุซููู',
                                                    'tuesday' => 'ุงูุซูุงุซุงุก',
                                                    'wednesday' => 'ุงูุฃุฑุจุนุงุก',
                                                    'thursday' => 'ุงูุฎููุณ',
                                                    'friday' => 'ุงูุฌูุนุฉ',
                                                ])
                                                ->required(),
                                        ])
                                        ->minItems(1)
                                        ->addable()
                                        ->reorderable()
                                        ->deletable(),
                                ]),
                                Section::make('ุฃููุงุช ุงูุตูุงุฉ')->schema([
                                    Repeater::make('prayer_times')
        ->label('ุฃููุงุช ุงูุตูุงุฉ')
        ->schema([
            TextInput::make('prayer_name')->label('ุงุณู ุงูุตูุงุฉ')->required(),
            TextInput::make('prayer_time')->label('ุงูููุช (HH:MM)')->required(),
        ])
        ->default(PrayerTimeService::getPrayerTimes(24.7136, 46.6753)),
                                ]),
                            ]),



                        ])->columnSpanFull()

                ])
        ]);
    }
}
